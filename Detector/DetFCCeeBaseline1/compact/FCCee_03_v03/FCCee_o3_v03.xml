<!--
  - set OuterTracker_half_length = InnerTracker_half_length
-->
<lccdd xmlns:compact="http://www.lcsim.org/schemas/compact/1.0"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xs:noNamespaceSchemaLocation="http://www.lcsim.org/schemas/compact/1.0/compact.xsd">
    
    <info name="CLIC_o2_v04"
        title="CLIC detector model option 2 version 04"
        author="Marko Petric"
        url="https://twiki.cern.ch/twiki/bin/view/CLIC/NewCLIC"
        status="development"
        version="$Id: 2015-1-4 marko.petric@cern.ch $">
        <comment>The compact format for the CLIC Detector design</comment>
    </info>
    
    <includes>
        <gdmlFile  ref="elements.xml"/>
        <gdmlFile  ref="materials.xml"/>
    </includes>
    
    <define>
        <constant name="world_side" value="7000*mm"/>
        <constant name="world_x" value="world_side"/>
        <constant name="world_y" value="world_side"/>
        <constant name="world_z" value="world_side"/>
        
       <constant name="CrossingAngle" value="0.030*rad"/>  

       <!-- <constant name="CrossingAngle" value="-0.030*rad"/>   -->


        <constant name="SolenoidField" value="2*tesla"/>
        
        
        <constant name="DetID_NOTUSED"          value=" 0"/>

        <constant name="DetID_VXD_Barrel"       value=" 1"/>
        <constant name="DetID_VXD_Endcap"       value=" 2"/>

        <constant name="DetID_IT_Barrel"        value=" 3"/>
        <constant name="DetID_IT_Endcap"        value=" 4"/>

        <constant name="DetID_OT_Barrel"        value=" 5"/>
        <constant name="DetID_OT_Endcap"        value=" 6"/>
        
        <constant name="DetID_ECal_Barrel"      value=" 20"/>
        <constant name="DetID_ECal_Endcap"      value=" 29"/>
        <constant name="DetID_ECal_Plug"        value=" 21"/>
        
        <constant name="DetID_HCAL_Barrel"      value=" 10"/>
        <constant name="DetID_HCAL_Endcap"      value=" 11"/>
        <constant name="DetID_HCAL_Ring"        value=" 12"/>
        
        <constant name="DetID_Yoke_Barrel"      value=" 13"/>
        <constant name="DetID_Yoke_Endcap"      value=" 14"/>
        
        <constant name="DetID_LumiCal"          value=" 15"/>
        <constant name="DetID_BeamCal"          value=" 16"/>
        
        <constant name="BeamPipeWidth"   	value="0.5*mm" />
        <constant name="CentralBeamPipe_zmax" value="25*cm"/>
	<constant name="SeparatedBeamPipe_z" value="100*cm"/>
        <constant name="CentralBeamPipe_rmax" value="20.0*mm"/>
<!--
        <constant name="ConeBeamPipe_zmax" value="1100*mm"/>
        <constant name="ConeBeamPipe_rmax" value="116.0*mm"/>
-->
        <!-- <constant name="ConeBeamPipe_rmax" value="221.0*mm"/>  -->

<!--  a cone until lumi front face, within the 100 mrad cone. To be followed by a Tube in the support of InnerTracker_o2_v03_02.xml -->
<!--
     	
        <constant name="ConeBeamPipe_zmax" value="1300*mm"/>
	<constant name="ConeBeamPipe_rmax_1"  value="131*mm"/>  
-->
<!-- instead : the support cone extends until the end of the inner tracker, no Tube -->
        <constant name="InnerTracker_half_length" value="2190*mm" />

        <constant name="ConeBeamPipe_zmax" value="InnerTracker_half_length" />
        <constant name="ConeBeamPipe_rmax_1"  value="InnerTracker_half_length * 0.1 + 1*mm" />

        <constant name="BigBeamPipe_zmax" value="1120*mm"/>
        <constant name="SeparatedBeamPipe_rmax"  value="12*mm"/>
        <constant name="BeamPipeTantalShieldWidth"  value="0.5*mm"/>
        <constant name="BeamPipe_end" value="12500*mm"/>
        
        
        
        <!-- ################### ENVELOPE PARAMETERS ######################################################## -->
        
        <comment> suggested naming convention:
            
            main parameters:
            
            DET_inner_radius    : inner radius of tube like envelope  ( inscribed cylinder )
            DET_outer_radius    : outer radius of tube like envelope  ( circumscribed cylinder )
            DET_half_length     : half length along z axis
            DET_min_z           : smallest absolute value on z-axis
            DET_max_z           : largest  absolute value on z-axis
            DET_inner_symmetry  : number of sides on the inside  ( 0 for tube )
            DET_outer_symmetry  : number of sides on the inside  ( 0 for tube )
            DET_inner_phi0      : optional rotation of the inner polygon ( in r-phi plane )
            DET_outer_phi0      : optional rotation of the outer polygon ( in r-phi plane )
            
            additional parameters for cutting away volumes/shapes use one of the above with a number
            appended and/or an extra specifiaction such as cone ( for a cut away cone )
            
            DET_inner_radius_1
            DET_outer_radius_2
            DET_cone_min_z
            DET_cone_max_z
            
        </comment>
        
        <constant name="env_safety" value="0.1*mm"/>
        
<!-- for ILD central VTX :    -->

        <constant name="TUBE_IPInnerTube_end_z"         value="80*mm"/>
        <constant name="TUBE_IPInnerBulge_end_z"        value="150*mm"/>
        <constant name="TUBE_IPInnerBulge_end_radius"   value="24*mm"/>

        <constant name="VXD_inner_radius"   value=" 15*mm "/>
        <constant name="VXD_half_length"    value=" 177.6*mm "/>
        <constant name="VXD_cone_min_z"     value=" TUBE_IPInnerTube_end_z "/>
        <constant name="VXD_cone_max_z"     value=" TUBE_IPInnerBulge_end_z "/>
        <constant name="VXD_inner_radius_1" value=" TUBE_IPInnerBulge_end_radius + env_safety "/>

  <constant name="VXD_outer_radius" value="60.*mm"/>
  <constant name="VXD_radius_r1" value="16*mm"/>
  <constant name="VXD_radius_r2" value="25*mm"/>
  <constant name="VXD_radius_r3" value="37*mm"/>
  <constant name="VXD_radius_r4" value="48*mm"/>
  <constant name="VXD_radius_r5" value="58*mm"/>

  <constant name="VXD_length_r1" value="62.5*mm"/>
  <constant name="VXD_length_r2" value="125*mm"/>
  <constant name="VXD_length_r4" value="125*mm"/>
  <constant name="VXD_length_r5" value="125*mm"/>
  <constant name="VXD_length_r3" value="125*mm"/>

  <constant name="VXD_cryostat_option" value="0"/>

<!--
<constant name="FTD_half_length"     value="1100*mm"/> 
<constant name="FTD_inner_radius"    value=" 115*cm"/>
        <constant name="FTD_outer_radius_1"  value="115*cm"/>
        <constant name="FTD_outer_radius_2"  value="115*cm"/>
        <constant name="FTD_outer_radius"    value=" 115*cm"/>
        <constant name="FTD_min_z_0"         value=" VXD_half_length   + env_safety"/>
        <constant name="FTD_min_z_1"         value="FTD_min_z_0 + 20*mm" />
        <constant name="FTD_min_z_2"         value=" FTD_min_z_1 + 20*mm" />
        <constant name="FTD_cone_min_z"      value="40*cm"/>
        <constant name="FTD_cone_radius"     value=" 100*mm"/>

 <constant name="TPC_Ecal_Hcal_barrel_halfZ" type="string" value="2350" />
<constant name="Ecal_endcap_zmin" value="2450.0*mm"/>
<constant name="TPC_inner_radius"    value="329*mm"/>

-->



<!--
-->


<!--
        <constant name="Vertex_inner_radius" value="30*mm"/>
        <constant name="Vertex_outer_radius" value="111*mm"/>
        <constant name="Vertex_half_length" value="260*mm"/>
-->
        
        <constant name="Vertex_inner_radius" value="21*mm"/>
        <constant name="Vertex_outer_radius" value="111*mm"/>
        <constant name="Vertex_half_length" value="260*mm"/>

        <constant name="InnerTracker_inner_radius" value="61*mm"/>
        <constant name="InnerTracker_outer_radius" value="580*mm"/>
        <!--<constant name="InnerTracker_half_length" value="2345*mm"/>  -->
        <!-- <constant name="InnerTracker_half_length" value="2190*mm" />  -->   <!-- given above -->
        
        <constant name="OuterTracker_inner_radius" value="580*mm"/>
        <constant name="OuterTracker_outer_radius" value="1500*mm - 0.1*mm"/>  <!-- to avoid overlap with CaloFace-->
        <constant name="OuterTracker_half_length" value="2190*mm"/>
        
        <constant name="ECalBarrel_inner_radius" value="1500*mm"/>
        <constant name="ECalBarrel_outer_radius" value="1659*mm"/>
        <constant name="ECalBarrel_half_length" value="2250*mm"/>
        <constant name="ECalBarrel_symmetry" value="12"/>
        
        <constant name="ECalEndcap_inner_radius" value="410*mm"/>
        <constant name="ECalEndcap_outer_radius" value="1700*mm"/>
        <constant name="ECalEndcap_min_z" value="2350*mm"/>
        <constant name="ECalEndcap_max_z" value="2509*mm"/>
        <constant name="ECalEndcap_outer_symmetry" value="12"/>
        <constant name="ECalEndcap_inner_symmetry" value="12"/>
        
        <constant name="ECalPlug_inner_radius" value="260*mm"/>
        <constant name="ECalPlug_outer_radius" value="380*mm"/>
        <constant name="ECalPlug_min_z" value="2350*mm"/>
        <constant name="ECalPlug_max_z" value="2509*mm"/>
        <constant name="ECalPlug_outer_symmetry" value="12"/>
        <constant name="ECalPlug_inner_symmetry" value="12"/>
        
        <constant name="HCalBarrel_inner_radius" value="1697*mm"/>
        <constant name="HCalBarrel_outer_radius" value="3287*mm"/>
        <constant name="HCalBarrel_half_length" value="2250*mm"/>
        <constant name="HCalBarrel_symmetry" value="12"/>
        
        <constant name="HCalEndcap_inner_radius" value="250*mm"/>
        <constant name="HCalEndcap_outer_radius" value="3203*mm"/>
        <constant name="HCalEndcap_min_z" value="2539*mm"/>
        <constant name="HCalEndcap_max_z" value="4129*mm"/>
        <constant name="HCalEndcap_symmetry" value="12"/>
        <constant name="HCalEndcap_zcutout" value="200*mm"/>
        <constant name="HCalEndcap_rcutout" value="180*mm"/>
        
        <constant name="HCalRing_inner_radius" value="1730*mm"/>
        <constant name="HCalRing_outer_radius" value="HCalEndcap_outer_radius"/>
        <constant name="HCalRing_min_z" value="2400*mm"/>
        <constant name="HCalRing_max_z" value="2539*mm"/>
        <constant name="HCalRing_symmetry" value="12"/>
        
        <constant name="Solenoid_inner_radius" value="3440*mm"/>
        <constant name="Solenoid_outer_radius" value="4192*mm"/>
        <constant name="Solenoid_half_length" value="4129*mm"/>
        <constant name="Solenoid_Coil_half_length" value="3900*mm"/>        
        <constant name="Solenoid_Coil_radius" value="3778*mm"/>
        
        <constant name="YokeBarrel_inner_radius" value="4418*mm"/>
        <constant name="YokeBarrel_outer_radius" value="7004*mm"/>
        <constant name="YokeBarrel_half_length" value="4129*mm"/>
        <constant name="YokeBarrel_symmetry" value="12"/>
        
        <constant name="YokeEndcap_inner_radius" value="630*mm"/>
        <constant name="YokeEndcap_outer_radius" value="7004*mm"/>
        <constant name="YokeEndcap_min_z" value="4179*mm"/>
        <constant name="YokeEndcap_max_z" value="5179*mm"/>
        <constant name="YokeEndcap_outer_symmetry" value="12"/>
        <constant name="YokeEndcap_inner_symmetry" value="0"/>
        
        <constant name="CompSol_min_z" value="1300*mm"/>

<!--
        <constant name="LumiCal_outer_radius" value="190*mm"/>
-->
        <constant name="LumiCal_max_z" value="CompSol_min_z - 1*cm" />
        <constant name="LumiCal_min_z" value="LumiCal_max_z - 20*cm"/>

        <constant name="LumiCal_dz" value="(LumiCal_max_z-LumiCal_min_z)/2.0"/>
<!--
        <constant name="LumiCal_outer_radius" value="LumiCal_min_z * 0.1 - LumiCal_min_z * CrossingAngle/2"/>
        <constant name="LumiCal_inner_radius" value="LumiCal_max_z*CrossingAngle + SeparatedBeamPipe_rmax + 5*mm" />
-->

        <constant name="LumiCal_outer_radius" value="LumiCal_min_z * 0.1 - LumiCal_min_z * abs(CrossingAngle)/2"/>
        <constant name="LumiCal_inner_radius" value="LumiCal_max_z*abs(CrossingAngle) + SeparatedBeamPipe_rmax + 5*mm" />



        
        <constant name="BeamCal_inner_radius" value="32*mm"/>
        <constant name="BeamCal_outer_radius" value="150*mm"/>
        <constant name="BeamCal_min_z" value="3181*mm"/>
        <constant name="BeamCal_max_z" value="3441*mm"/>
        <constant name="BeamCal_dz" value="(BeamCal_max_z-BeamCal_min_z)/2.0"/>

        <constant name="Kicker_inner_radius" value="4*mm"/>
        <constant name="Kicker_outer_radius" value="25*mm"/>
        <constant name="Kicker_min_z" value="3480*mm"/>
        <constant name="Kicker_max_z" value="3780*mm"/>
        
        <constant name="BPM_inner_radius" value="36*mm"/>
        <constant name="BPM_outer_radius" value="55*mm"/>
        <constant name="BPM_min_z" value="3790*mm"/>
        <constant name="BPM_max_z" value="3880*mm"/>        

        <constant name="QD0_min_z" value="2200*mm"/>
        <constant name="QD0_max_z" value="5400*mm"/>
	<constant name="QD0Coil_outer_radius" value="30*mm"/>
        <constant name="CollimatorInFrontOfQD0_dz" value="20*cm"/>   
        <constant name="CollimatorInFrontOfQD0_radius" value="10*mm"/>
        <constant name="CollimatorInFrontOfQD0_dr" value="16*mm"/>
        
        <constant name="tracker_region_zmax" value="OuterTracker_half_length"/>
        <constant name="tracker_region_rmax" value="OuterTracker_outer_radius"/>
    </define>
    
    <limits>
        <limitset name="cal_limits">
            <limit name="step_length_max" particles="*" value="5.0" unit="mm" />
        </limitset>
        <limitset name="SiTrackerBarrelRegionLimitSet">
            <limit name="step_length_max" particles="*" value="5.0" unit="mm" />
            <limit name="track_length_max" particles="*" value="5.0" unit="mm" />
            <limit name="time_max" particles="*" value="5.0" unit="ns" />
            <limit name="ekin_min" particles="*" value="0.01" unit="MeV" />
            <limit name="range_min" particles="*" value="5.0" unit="mm" />
        </limitset>

<!-- for ILD vertex detector: -->
        <limitset name="Tracker_limits">
            <limit name="step_length_max" particles="*" value="5.0" unit="mm" />
        </limitset>

    </limits>
    <regions>
        <region name="SiTrackerBarrelRegion" eunit="MeV" lunit="mm" cut="0.001" threshold="0.001">
            <limitsetref name="SiTrackerBarrelRegionLimitSet"/>
        </region>
    </regions>
    
    
    
    <display>

<!--
        <vis name="VXDVis"      alpha="1.0" r="0.2"   g="0.2"     b="0.2"   showDaughters="true"  visible="true"/>
-->
      <vis name="VXDVis"        alpha="0.1" r="0.1" g=".5"  b=".5"   showDaughters="true"  visible="false"/>

      <vis name="VXDLayerVis"   alpha="1.0" r="0.1" g=".5"  b=".5"   showDaughters="true"  visible="true"/>

      <vis name="VXDSupportVis" alpha="1.0" r="0.0" g="1.0" b="0.0"  showDaughters="true"  visible="false"/>


        <vis name="ITVis"       alpha="1.0" r="0.54"  g="0.43"    b="0.04"  showDaughters="true"  visible="true"/>
        <vis name="OTVis"       alpha="1.0" r="0.8"   g="0.8"     b="0.4"   showDaughters="true"  visible="true"/>
        <vis name="ECALVis"     alpha="1.0" r="0.2"   g="0.6"     b="0"     showDaughters="true"  visible="true"/>
        <vis name="HCALVis"     alpha="1.0" r="0.078" g="0.01176" b="0.588" showDaughters="true"  visible="true"/>
        <vis name="SOLVis"      alpha="1.0" r="0.4"   g="0.4"     b="0.4"   showDaughters="true"  visible="true"/>
        <vis name="YOKEVis"     alpha="1.0" r="0.6"   g="0.0"     b="0.0"   showDaughters="true"  visible="true"/>
<!--
        <vis name="LCALVis"     alpha="1.0" r="0.35"  g="0.0"     b="0.47"  showDaughters="true"  visible="true"/>
-->
        <vis name="LCALVis"    alpha="1.0" r="0.25"  g="0.88"    b="0.81"  showDaughters="true"  visible="true"/>

        <vis name="BCALVis"     alpha="1.0" r="0.0"   g="0.4"     b="0.4"   showDaughters="true"  visible="true"/>
        <vis name="KICKVis"     alpha="1.0" r="1.0"   g="0.498"   b="0.0"   showDaughters="true"  visible="true"/> 
        <vis name="QD0CoilIVis"     alpha="1.0" r="1.0"   g="0.498"   b="0.0"   showDaughters="true"  visible="true"/>
        <vis name="QD0CoilOVis"     alpha="1.0" r="1.0"   g="0.25"   b="0.0"   showDaughters="true"  visible="true"/>
        <vis name="CompSolVis"     alpha="1.0" r="0.5"   g="0.5"   b="0.0"   showDaughters="true"  visible="true"/>
        <vis name="ScreenSolVis"     alpha="0.0" r="1"   g="1"   b="0"   showDaughters="true"  visible="true"/>
        <vis name="ColliVis"        alpha="1.0" r="0.7"   g="0.5"   b="1"   showDaughters="true"  visible="true"/>
        <vis name="TantalumVis"     alpha="0.0" r="1"   g="0.5"   b="0.5"   showDaughters="true"  visible="true"/>

        <vis name="BPMVis"      alpha="1.0" r="0.25"  g="0.88"    b="0.81"  showDaughters="true"  visible="true"/>                           
        <vis name="SupportVis"  alpha="1"   r="0.2"   g="0.2"     b="0.2"   showDaughters="false" visible="true"/>        
    </display>
    
    <include ref="Materials_v01.xml"/>

    <include ref="Beampipe_o3_v01.xml"/>  
    <!-- <include ref="Beampipe_o3_v01_noMask.xml"/>  -->

    <include ref="BeamInstrumentation_o3_v01.xml"/>     
    <include ref="LumiCal_o3_v01_01.xml"/>

    <include ref="Vertex_o3_v03.xml"/>  

    <include ref="InnerTracker_o3_v03.xml"/>   
    <include ref="OuterTracker_o2_v03_03.xml"/>
    
    <include ref="ECalBarrel_o2_v01_01.xml"/>
    <include ref="ECalEndcap_o2_v01_01.xml"/>
    <include ref="ECalPlug_o1_v01_01.xml"/>
    
    <include ref="HCalBarrel_o1_v01_01.xml"/>
    <include ref="HCalEndcap_o1_v01_01.xml"/>

    <include ref="Solenoid_o1_v01_01.xml"/>

    <include ref="YokeBarrel_o1_v01_01.xml"/>
    <include ref="YokeEndcap_o1_v01_01.xml"/>

<!--
    <include ref="BeamCal_o1_v01_01.xml"/>
-->

    <plugins>
      <plugin name="InstallSurfaceManager"/>
    </plugins>

    <fields>

      <field name="GlobalSolenoid" type="solenoid"
             inner_field="SolenoidField"
             outer_field="-1.5*tesla"
             zmax="Solenoid_Coil_half_length"
             outer_radius="Solenoid_Coil_radius">
      </field>

      <field name="CompensatingSolenoidZplus" type="solenoid"
             inner_field="-SolenoidField -SolenoidField * QD0_min_z / ( QD0_min_z - CompSol_min_z)"
             outer_field="0*tesla"
             zmax="QD0_min_z"
	     zmin="CompSol_min_z"
             outer_radius="20*cm">
      </field>

      <field name="CompensatingSolenoidZminus" type="solenoid"
             inner_field="-SolenoidField -SolenoidField * QD0_min_z / ( QD0_min_z - CompSol_min_z)"
             outer_field="0*tesla"
             zmin="-QD0_min_z"
             zmax="-CompSol_min_z"
             outer_radius="20*cm">
      </field>


<!-- to check with the visualisation that this works... :

      <field name="GlobalSolenoid" type="solenoid"
             inner_field="SolenoidField"
             outer_field="-1.5*tesla"
             zmax="1*m"
             outer_radius="Solenoid_Coil_radius">
      </field>

      <field name="CompensatingSolenoid" type="solenoid"
             inner_field="-SolenoidField"
             outer_field="0*tesla"
             zmax="3*m"
             zmin="1*m"
             outer_radius="Solenoid_Coil_radius">
      </field>
-->


    </fields> 


</lccdd>

