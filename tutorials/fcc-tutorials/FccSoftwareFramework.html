<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Fcc Software Framework</title>
  <meta name="description" content="Main page for documentation and resources.">

  <link rel="stylesheet" href="http://fccsw.web.cern.ch/fccsw/css/main.css">
  <link rel="canonical" href="http://fccsw.web.cern.ch/fccsw/tutorials/fcc-tutorials/FccSoftwareFramework.html">
  <link rel="alternate" type="application/rss+xml" title="FCCSW" href="http://fccsw.web.cern.ch/fccsw/feed.xml">
</head>


  <body>

    
<header>
   <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://fccsw.web.cern.ch/fccsw/index.html">FCCSW</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li ><a href="http://fccsw.web.cern.ch/fccsw/index.html">Home</a></li>
            <li  class="active" ><a href="http://fccsw.web.cern.ch/fccsw/tutorials">Tutorials</a></li>
            <li><a>Latest Releases:</a></li>
            
            
              
              <li >
                <a href="http://fccsw.web.cern.ch/fccsw/2017/05/15/version081.html">FCCSW v0.8.1</a>
              </li>
              
            
              
              <li >
                <a href="http://fccsw.web.cern.ch/fccsw/2017/03/29/version08.html">FCCSW v0.8</a>
              </li>
              
            
            <li ><a href="http://fccsw.web.cern.ch/fccsw/snapshot.html">Snapshot</a></li>
          </ul>
          <form class="navbar-form navbar-right">
            <div class="input-group">
            <span class="input-group-addon" id="basic-addon1"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></span>
            <input type="text" class="form-control" id="search-input" placeholder="Search" aria-describedby="basic-addon1">
            </div>
          </form>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

</header>
<div class="container">
  <div class="collapse panel panel-default" id="resultswrap">
      <div class="panel-heading">Search Results <button type="button" class="close" aria-label="Close"><span aria-hidden="true" onclick="$('#resultswrap').collapse('hide');">&times;</span></button></div>
      <ul id="searchresults" class="list-group">
      </ul>
  </div>
</div>

    
    
    <div class="container">
      <div class="col-md-10">
        <h1 id="fccsw">FCCSW</h1>

<p>Contents:</p>

<ul>
  <li><a href="#fccsw">FCCSW</a>
    <ul>
      <li><a href="#overview">Overview</a></li>
      <li><a href="#git-guide-for-fcc">Git guide for FCC</a></li>
      <li><a href="#cmake">CMake</a></li>
      <li><a href="#installation">Installation</a></li>
      <li><a href="#running-an-fcc-application">Running an FCCSW application</a></li>
      <li><a href="#example-process">Example process</a></li>
      <li><a href="#exercises">Exercises</a>
        <ul>
          <li><a href="#1--modifying-an-existing-algorithm">1- Modifying an existing algorithm</a></li>
          <li><a href="#2--changing-an-algorithm-parameter">2- Changing an algorithm parameter</a></li>
          <li><a href="#3--adding-a-filtering-algorithm">3- Adding a filtering algorithm</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="overview">Overview</h2>

<p>The FCC software framework is based on Gaudi, with a simple event data
model (EDM) library called PODIO (Plain Old Data Input / Output). The
code is managed with Git, and built using CMake.</p>

<h2 id="git-guide-for-fcc">Git guide for FCC</h2>

<p>The code for both the FCC software and Gaudi is managed on Git
repositories. We have set up a short <a href="./FccSoftwareGit">Git guide</a> for
people who are not familar with Git, and where we explain the
recommended way to contribute code to the FCC software.</p>

<div class="panel panel-info">
    <div class="panel-heading"><h3 class="panel-title">
        <span class="glyphicon glyphicon-info-sign" aria-hidden="true"> </span>
        Recommendation
    </h3></div>
    <div class="panel-body">
     <p>All new developers should read this guide since it also contains information on how to contribute to the FCC software.</p>
    </div>
</div>

<h2 id="cmake">CMake</h2>

<p>The build process of the FCC software is managed with CMake. Here is a
<a href="./FccCMakeGuide.html">short CMake guide</a> for FCC developers.</p>

<h2 id="installation">Installation</h2>

<p>Log in an lxplus6 machine and follow <a href="../FCCSW/README.html">these instructions</a>, also
see the <a href="./FccSoftwareGettingStarted.html">getting started instructions</a>.</p>

<h2 id="running-an-fccsw-application">Running an FCCSW application</h2>

<p>In the FCCSW folder you will find an executable script <code class="highlighter-rouge">run</code>. This will only work after compiling the framework.</p>

<p>The run command expects as it’s first argument the run command, which usually is <code class="highlighter-rouge">gaudirun.py</code>. With this you can use python to run an FCCSW application</p>

<h2 id="example-process">Example process</h2>

<p>An example configuration file is provided in
<a href="https://github.com/HEP-FCC/FCCSW/blob/tutorial/simple_workflow.py">simple_workflow.py</a>. This configuration file allows to execute the following tasks for each
event:</p>

<ul>
  <li>read an <a href="http://lcgapp.cern.ch/project/simu/HepMC/20400/html/classHepMC_1_1GenEvent.html">HepMC</a> text file</li>
  <li>convert the HepMC particles to a collection of EDM
<a href="http://fccsw.web.cern.ch/fccsw/fcc-edm/d5/d95/classfcc_1_1_m_c_particle_collection.html">ParticleCollection</a></li>
  <li>read the EDM
<a href="http://fccsw.web.cern.ch/fccsw/fcc-edm/0.4/de/d22/classfcc_1_1_m_c_particle.html">Particles</a>
and use fastjet to cluster them into EDM <a href="http://fccsw.web.cern.ch/fccsw/fcc-edm/0.4/d9/dd7/classfcc_1_1_gen_jet.html">Jets</a> .</li>
  <li>write an EDM root file</li>
</ul>

<p>Run Gaudi on the example HepMC source text file (1000 Z production events in an e+e- collider at sqrt(s) = 91 GeV) using this configuration file:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>    ./run gaudirun.py Examples/options/simple_workflow.py
</code></pre>
</div>

<p>Please have a detailed look at <a href="https://github.com/HEP-FCC/FCCSW/blob/master/Examples/options/simple_workflow.py">simple_workflow.py</a>.
.</p>

<h2 id="exercises">Exercises</h2>

<h3 id="modifying-an-existing-algorithm">1- Modifying an existing algorithm</h3>

<ul>
  <li>locate the C++ code of the jet clustering algorithm (maybe do a
recursive grep for jet or clustering?)</li>
  <li>add a printout for the reconstructed jets in the <code class="highlighter-rouge">execute</code>
function of the jet clustering algorithm.</li>
  <li>recompile and run again:</li>
</ul>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="c"># in the FCCSW directory:</span>
make
</code></pre>
</div>

<p>Note how the total energy is generally way too high. It is due to the
fact that both stable and unstable particles are clustered into jets,
hence a double counting of the energy. In exercise 3, we will see how to
filter the generated particles to send only the stables ones to jet
clustering.</p>

<h3 id="changing-an-algorithm-parameter">2- Changing an algorithm parameter</h3>

<p>Open <a href="https://github.com/HEP-FCC/FCCSW/blob/master/Reconstruction/RecCalorimeter/src/components/JetClustering.cpp">JetClustering.cpp</a> and <a href="https://github.com/HEP-FCC/FCCSW/blob/master/Reconstruction/RecCalorimeter/src/components/JetClustering.h">JetClustering.h</a>, and have a look at the constructor of the class. Several properties
are declared.</p>

<p>Properties can be set in the configuration file.</p>

<p>Change the configuration of the JetClustering algorithm in the following
way:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code>    <span class="n">genjet_clustering</span> <span class="o">=</span> <span class="n">JetClustering_MCParticleCollection_GenJetCollection_</span><span class="p">(</span>
        <span class="s">"GenJetClustering"</span><span class="p">,</span>
        <span class="n">ptMin</span> <span class="o">=</span> <span class="mf">30.</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre>
</div>

<p>And check the results. Do you see a difference in the momentum distribution of the jets?</p>

<h3 id="adding-a-filtering-algorithm">3- Adding a filtering algorithm</h3>

<p>The goal of this exercise is to fix the energy double counting obersved
in exercise 1. The current algorithm sequence contains three algorithms:
<code class="highlighter-rouge">[reader, hepmc_converter, genjet_clustering]</code>. We want to insert a
new algorithm in the sequence, which would become:
<code class="highlighter-rouge">[reader, hepmc_converter, genp_filter, genjet_clustering]</code>.</p>

<p>The new algorithm, <code class="highlighter-rouge">genp_filter</code>, will:</p>

<ul>
  <li>read in input the genparticles created by the <code class="highlighter-rouge">hepmc_converter</code></li>
  <li>write in output a copy of all the stable gen particles (status 1),
discarding the other particles.</li>
</ul>

<p>Go to the <code class="highlighter-rouge">Generation/</code> directory.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nb">cd </span>Generation/src/components
</code></pre>
</div>

<p>Take the ReadTestConsumer as a baseline, and make a GenParticleFilter
algorithm:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>cp ../../../Examples/src/ReadTestConsumer.cpp MyGenParticleFilter.cpp
<span class="c"># If the relative path does not work: Examples is directly in the FCCSW folder</span>
</code></pre>
</div>

<p>Since you created new files, next time you compile, you will need to do
the following so that your files are detected by the build system:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nb">cd</span> ../../../ <span class="c"># go to the FCCSW root directory</span>
<span class="nb">pwd</span> <span class="c"># make sure you actually are in the FCCSW root directory</span>
make configure
make -j 4
</code></pre>
</div>

<p>When you just edit existing files, you don’t need to reconfigure, and just do:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>make -j 4
</code></pre>
</div>

<p><strong>Edit the GenParticleFilter</strong> so that:</p>

<ul>
  <li>the class name matches your file name (also note the <code class="highlighter-rouge">DECLARE_COMPONENT</code> at the end of the file)</li>
  <li>it creates as output a MCParticleCollection (see <a href="https://github.com/HEP-FCC/FCCSW/blob/master/Generation/src/HepMCConverter.cpp">HepMCConverter</a>)</li>
  <li>it copies only the particles with status 1 to the output collection
(see the <a href="http://fccsw.web.cern.ch/fccsw/fcc-edm/0.4/de/d22/classfcc_1_1_m_c_particle.html">MCParticle.h</a>
and <a href="http://fccsw.web.cern.ch/fccsw/fcc-edm/0.4/d2/df9/classfcc_1_1_bare_particle.html">BareParticle.h</a>
classes to see which data members are available)</li>
</ul>

<p>Finally, insert the new algorithm in the sequence in the configuration
file, and run again. Check the printout and make sure that the jet
energy is now what you would expect (around 45 GeV).</p>

      </div>
      <div class="col-md-2">    <ul class="list-group">
        <li class="list-group-header">
            <h4>External links</h4>
        </li>
        
            <li class="list-group-item">
                <a href='http://cern.ch/simba3/SelfSubscription.aspx?groupName=fcc-experiments-sw-dev'>FCCSW Mailing list</a>
            </li>
        
            <li class="list-group-item">
                <a href='http://fccsw.web.cern.ch/fccsw/tutorials/'>FCCSW Tutorials</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://github.com/HEP-FCC/fccsw/issues'>FCCSW Issue Tracker</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://github.com/HEP-FCC/'>FCCSW on GitHub</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://phsft-jenkins.cern.ch/view/FCC/'>FCCSW Jenkins</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://github.com/HEP-FCC/FCCSW/blob/master/doc/CppCodingStyleGuidelines.md'>FCCSW C++ Style Guide</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://github.com/HEP-FCC/FCCSW/blob/master/doc/GeneralCppGuidelines.md'>General C++ Guidelines</a>
            </li>
        
    </ul>
</div>
    </div>
    <script src="http://fccsw.web.cern.ch/fccsw/node_modules/jquery/dist/jquery.min.js" type="text/javascript"></script>
<script src="http://fccsw.web.cern.ch/fccsw/node_modules/bootstrap-sass/assets/javascripts/bootstrap.min.js" type="text/javascript"></script>
<script src="http://fccsw.web.cern.ch/fccsw/node_modules/requirejs/require.js" type="text/javascript"></script>
<script src="http://fccsw.web.cern.ch/fccsw/node_modules/simple-jekyll-search/dest/simple-jekyll-search.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script type="text/javascript">
      SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('searchresults'),
        json: 'http://fccsw.web.cern.ch/fccsw/search.json',
        searchResultTemplate: '<li class="list-group-item"><a href="{url}" title="{desc}">{title}</a></li>',
        noResultsText: '<li class="list-group-item">No results found</li>',
        limit: 10,
        fuzzy: false,
        exclude: ['Welcome']
      });
      $("#search-input").keypress(function() {
            $("#resultswrap").collapse('show');
      });
      $("#search-input").keyup(function() {
            if ($(this).val() == "") {
                $("#resultswrap").collapse('hide');
            }
      });
      $("table").each(function(index) {
        $(this).addClass("table");
      });
    </script>


  </body>
</html>
