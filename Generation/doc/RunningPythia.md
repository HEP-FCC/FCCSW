Running Pythia in FCCSW
=======================

- [Overview](#overview)
- [Pythia configuration](#pythia-configuration)
- [Running pythia](#running-pythia)

Overview
--------

Pythia can be used to generate events or to do hadronisation of events generated by other tools, e.g. Madgraph. Pythia
supports configuration through `cmd` files that are also used in FCCSW. The output of Pythia is translated into the
[HepMC](http://lcgapp.cern.ch/project/simu/HepMC/) event data format. Optionally we can translate this into the
[FCC-EDM](https://github.com/HEP-FCC/fcc-edm/blob/master/README.md) and store it in a ROOT file.

Pythia configuration
--------------------

We have several Pythia configuration file(s), that show two different use cases in the
[Generation/data](https://github.com/HEP-FCC/FCCSW/tree/master/Generation/data)
directory:

-   [Pythia\_standard.cmd](https://github.com/HEP-FCC/FCCSW/blob/master/Generation/data/Pythia_standard.cmd)
    : no input, set Pythia configuration

-   [Pythia\_LHEinput.cmd](https://github.com/HEP-FCC/FCCSW/blob/master/Generation/data/Pythia_LHEinput.cmd)
    : read-in by Pythia-module the LHE file (generated by Madgraph,
    etc.), set Pythia configuration

-   [Pythia\_LHEinput\_Matching.cmd](https://github.com/HEP-FCC/FCCSW/blob/master/Generation/data/Pythia_LHEinput_matching.cmd)
    : read-in by Pythia-module the LHE file (generated by Madgraph), set Pythia configuration to perform ME/PS matching


-   **Pythia\_standard.cmd** : An example of standard Pythia
    configuration to start generation. Configuration parameters:
    -   `Random:setSeed = on` --> Apply user-set seed everytime the Pythia::init is called
    -   `Random:seed = 0` --> Set seed: -1=default seed, 0=seed based on time, >0 user seed number

-   **Pythia\_LHEinput.cmd** : An example of Pythia configuration to
    execute and work-out (process & hadronize) LHE event-data file and match matrix-element 
    (provided by e.g. Madgraph etc.). Configuration parameters:
    -   `PartonLevel:MPI = on/off` --> Switch on/off Multi-Particle-Interaction
    -   `PartonLevel:ISR = on/off` --> Switch on/off Initial-State-Radiation
    -   `PartonLevel:FSR = on/off` --> Switch on/off Final-State-Radiation
    -   `HadronLevel:all = on/off` --> Switch on/off Hadronization
    -   `HadronLevel:Decay = on/off` --> Switch on/off Decays
    -   `Beams:LHEF = data/name.lhe` --> Define LHE event data file

-   **Pythia\_LHEinput\_Matching.cmd** : An example of Pythia configuration to
    produce events with the correct description of higher jet multiplicites (ME/PS matching). 
    Important Configuration parameters:
    - `JetMatching:merge      = on/off` --> Switch on/off merging
    - `JetMatching:qCut       = 15`     --> Matching scale
    - `JetMatching:coneRadius = 1.0`    --> Cone for jet jet clustering
    - `JetMatching:etaJetMax  = 10.0`   --> Max eta of  jets
    - `JetMatching:nJetMax    = 2`      --> Max jet multiplicity defined in hard scattering

More information on PS/ME matching/merging with Pythia8 can be found 
[here](http://home.thep.lu.se/~torbjorn/pythia81html/MatchingAndMerging.html) and 
[here](http://home.thep.lu.se/~torbjorn/pythia81html/JetMatching.html).

A small example on how to validate the choice of parameters can be found
[here](https://github.com/HEP-FCC/fcc-physics/tree/master/pythia8/validation/README.md).

Running Pythia
--------------

A simple FCCSW configuration file exists that allows you to run Pythia with:

```
./run gaudirun.py Examples/options/simple_pythia.py
```

This gives you an `output.root` file that contains generated particles and vertices, as well as jets that are constructed
from the generated particles. The configuration runs five algorithms:

- GenAlg, with tool PythiaInterface: The actual interface that runs Pythia itself
- HepMCConverter: Translates HepMC output of PythiaInterface to FCC-EDM
- GenParticleFilter: Filters the generated particles
- JetClustering: Does the clustering of generated particles to `GenJets`
- PodioOutput: Saves the FCC-EDM collections to the ROOT file

